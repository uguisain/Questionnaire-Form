<div class="page-root bg">
  <div class="page-center">
<!-- 外層容器：置中、不滿版 -->
<div class="report-shell">
  <div class="report-title"><h2>{{ quiz?.title }}</h2></div>
  <!-- 圖表網格：多張圖自動排版 -->
    @for (Da of Report; track $index) {
      <div class="report-card" style="margin-bottom: 20px;">
        <div class="report-card__left">
          <canvas class="chart-canvas" #chartCanvas [id]="'q' + Da.questionId"></canvas>
        </div>

        <!-- 右：統計資訊 -->
      <div class="report-card__right">
        <!-- 題目 & 總覽 -->
        <div class="question-header">
          <div class="question-title">
            {{ Da.questionId }}. {{ getQ(Da.questionId)?.question }}
          </div>
          <div class="question-meta">
            <span>題型：{{ getQ(Da.questionId)?.type }} ｜</span>
            <span>必填：{{ getQ(Da.questionId)?.required ? '是' : '否' }} ｜</span>
            <span>總答題人數：{{ getTotalCount(Da.opCountList) }} 人</span>
          </div>
        </div>

        <!-- 各選項統計 -->
        <ul class="option-list">
          @for (row of Da.opCountList; track $index) {
            <li class="option-item">
              <span class="option-label">{{ row.optionName }}</span>

              <!-- 百分比條 -->
              <span class="option-bar">
                <span class="option-bar-fill"
                  [style.width.%]="getPercent(row.count, Da.opCountList)">
                </span>
              </span>

              <span class="option-count">
                {{ row.count }} 人 ({{ getPercent(row.count, Da.opCountList) }}%)
              </span>
            </li>
          }
        </ul>

        <!-- 額外摘要（讓右邊更飽滿一點，可選） -->
        <div class="question-summary">
          <div>最高票選項：{{ getTopOption(Da.opCountList)?.optionName || '—' }} ｜</div>
          <div>最低票選項：{{ getBottomOption(Da.opCountList)?.optionName || '—' }}</div>
        </div>
      </div>
      </div>
    }

  <div class="report-actions">
    <button class="btn-report-back" (click)="back()">返回清單</button>
  </div>
</div>
</div></div>
