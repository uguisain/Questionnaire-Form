<div class="page-root">
  <div class="page-center">
    <!-- 填寫模式 -->
    @if (pageMode === 'edit') {
    <!-- 如果 form 存在就顯示；否則顯示 notFound -->
    <div *ngIf="quiz" class="form-card">
      <!-- 表單名稱 -->
      <h2 class="form-title">{{ quiz.title }}</h2>

      <!-- 基本資訊 -->
      <div class="meta-card">
        <p class="meta-item">表單 ID：{{ quiz.id }}</p>
        <p class="meta-item">
          填寫期間：{{ quiz.startDate }} ～ {{ quiz.endDate }}
        </p>
      </div>
      <!-- 表單說明 -->
      <div class="meta-card">
        <p>表單說明：</p>
        <p class="meta-item">{{ quiz.description }}</p>
      </div>

      <!-- 使用者基本欄位 -->
      <div class="section">
        <div class="field-row">
          <label class="field-label">姓名</label>
          <input class="text-input" [(ngModel)]="userName" />
        </div>

        <div class="field-row">
          <label class="field-label">電話</label>
          <input
            class="text-input"
            type="number"
            [(ngModel)]="userPhoneNumber"
          />
        </div>

        <div class="field-row">
          <label class="field-label">信箱</label>
          <input class="text-input" type="email" [(ngModel)]="email" />
        </div>

        <div class="field-row">
          <label class="field-label">年齡</label>
          <input class="text-input" type="number" [(ngModel)]="userAge" />
        </div>
      </div>

      <!-- 問題欄位 -->
      <div class="section">
        <ol class="question-list">
          @for (question of questions; track $index; let i = $index) {

          <li class="question-item">
            @if (question.required) {
            <span class="badge-required">必填</span>
            }
            <span class="question-text">{{ question.question }}</span>

            @if (question.type === 'single') {
            <span style="font-size: small"> (單選)</span>
            <div class="option-list">
              @for (option of question.optionsList; track $index) {
              <label class="option-item">
                <input
                  class="opt-radio"
                  type="radio"
                  name="{{ question.questionId }}"
                  [checked]="isOptionTrue(i, option.code)"
                  (change)="selectSingle(i, option.code)"
                />
                <span>{{ option.optionName }}</span>
              </label>
              }
            </div>
            } @if (question.type === 'multiple') {
            <span style="font-size: small"> (複選)</span>
            <div class="option-list">
              @for (option of question.optionsList; track $index) {
              <label class="option-item">
                <input
                  class="opt-checkbox"
                  type="checkbox"
                  [checked]="isOptionTrue(i, option.code)"
                  (change)="toggleMulti(i, option.code, $event)"
                />
                <span>{{ option.optionName }}</span>
              </label>
              }
            </div>
            } @if (question.type === 'text') {
            <span style="font-size: small"> (簡答)</span>
            <div class="option-list">
              <textarea
                class="text-area"
                name="{{ question.questionId }}"
                [(ngModel)]="FillinReq[0].questionAnswerList[i].answerList"
              ></textarea>
            </div>
            }
          </li>
          }
        </ol>

        <!-- 操作列 -->
        <div class="actions">
          <button class="btn-primary" (click)="send()">下一步</button>
          <button class="btn-ghost" (click)="back()">返回清單</button>
        </div>
      </div>
      <!-- /.form-card -->
    </div>
    <!-- /.form-shell -->
    }

    <!-- 確認模式 -->
    @if (pageMode === 'confirm') {
    <div class="form-shell">
      <div class="confirm-card">
        <h3 class="confirm-title">請確認以下內容是否正確</h3>

        <!-- 基本資料小卡片 -->
        <div class="kv-card">
          <p class="kv-item">
            姓名：<b>{{ FillinReq[0].userName || userName }}</b>
          </p>
          <p class="kv-item">
            電話：<b>{{ FillinReq[0].userPhoneNumber || userPhoneNumber }}</b>
          </p>
          <p class="kv-item">
            信箱：<b>{{ FillinReq[0].email || email }}</b>
          </p>
          <p class="kv-item">
            年齡：<b>{{ FillinReq[0].userAge || userAge }}</b>
          </p>
        </div>

        <ol class="answer-list">
          @for (ans of FillinReq[0].questionAnswerList; track $index; let i =
          $index) {
          <li class="answer-item">
            <div class="answer-q">{{ ans.question }}</div>

            <div class="answer-a">
              <span class="badge-you">你的答案</span>
              <!-- 單選 / 多選 → 用同一個顯示函式 -->
              @if (questions[i].type === 'single') { {{ getAnswerDisplay(i) }} }
              @if (questions[i].type === 'multiple') {
              {{ getAnswerDisplay(i) }} } @if (questions[i].type === 'text') {
              {{ ans.answerList }} }
            </div>
          </li>
          }
        </ol>

        <div class="actions">
          <button class="btn-ghost" (click)="backToEdit()">返回修改</button>
          <button class="btn-primary" (click)="finalSubmit()">送出</button>
        </div>
      </div>
      <!-- /.confirm-card -->
    </div>
    <!-- /.form-shell -->
    }
  </div>
</div>
