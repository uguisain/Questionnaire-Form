<!-- 搜尋欄 -->
<div>
  問卷名稱: <input [(ngModel)]="searchname">
  <div>統計日期: <input type="date"
    [attr.min]="toDayStr"
    (change)="fromDate = $any($event.target).value; toDate = null">
    <!-- attr可避免把非字串帶入造成出錯 -->
        到
        <input type="date"
        [(ngModel)]="toDate"
        [attr.min]="fromDate || toDayStr"
        (change)="toDate">
        <!-- 這邊的[(ngModel)]可以同步控制畫面的日期 -->
  </div>
</div>

<!-- 清單資訊（總筆數 / 目前頁 / 總頁） -->
<div class="list-header" style="margin-bottom: 8px;">
  共 {{ totalItems }} 筆．第 {{ currentPage }} / {{ totalPages }} 頁
</div>

<!-- 羅列表單 -->
<table border="1" cellspacing="0" cellpadding="6">
  <thead>
    <tr>
      <th>表單ID</th>
      <th>問卷名稱</th>
      <th>狀態</th>
      <th>起始日期</th>
      <th>結束日期</th>
      <th>操作</th>
    </tr>
  </thead>

  <tbody>
    <!-- 用 *ngFor 逐筆列出資料 -->
    <tr *ngFor="let f of pagedList">
      <td>{{ f.id }}</td>
      <td>{{ f.name }}</td>
      <td>{{ stateLabel(getState(f)) }}</td>
      <td>{{ f.startDate }}</td>
      <td>{{ f.endDate }}</td>
      <td>
        <!-- 進行中：顯示「填寫」按鈕（可點） -->
      <button *ngIf="getState(f) === 'open'" (click)="goFill(f.id)">
        填寫
      </button>

      <!-- 已結束：顯示「檢視結果」按鈕（可點；目前先 console，之後導頁） -->
      <button *ngIf="getState(f) === 'closed'" (click)="viewResult(f.id)">
        檢視結果
      </button>

      <!-- 未開始：顯示禁用按鈕，不能點 -->
      <button *ngIf="getState(f) === 'notStarted'" disabled>
        尚未開始
      </button>
      </td>
    </tr>

    <tr *ngIf="pagedList.length === 0">
      <td colspan="6">目前沒有符合條件的資料。</td>
    </tr>
  </tbody>
</table>

<!-- 簡易分頁列（第一頁 / 上一頁 / 數字頁碼 / 下一頁 / 最後一頁） -->
<div style="display:flex; gap:8px; align-items:center; margin-top:12px; flex-wrap:wrap;">
  <button (click)="goToPage(1)" [disabled]="currentPage === 1">« 第一頁</button>          <!-- 直接跳到第一頁 -->
  <button (click)="prev()"      [disabled]="currentPage === 1">‹ 上一頁</button>           <!-- 往前一頁 -->

  <!-- 若開頭不是第1頁，顯示「...」提示 -->
  <span *ngIf="pageNumbers[0] > 1">...</span>

  <!-- 這裡畫出 1 ~ totalPages 的按鈕 -->
  <ng-container *ngFor="let n of pageNumbers">
    <button
      (click)="goToPage(n)"
      [disabled]="n === currentPage">
      {{ n }}
    </button>
  </ng-container>

  <!-- 若結尾不是最後一頁，也顯示「...」提示 -->
  <span *ngIf="pageNumbers[pageNumbers.length - 1] < totalPages">...</span>

  <button (click)="next()" [disabled]="currentPage === totalPages">下一頁 ›</button>   <!-- 往後一頁 -->
  <button (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">最後一頁 »</button> <!-- 直接跳最後頁 -->
</div>

<router-outlet></router-outlet>
